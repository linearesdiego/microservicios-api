# **Historias de Usuario Difexa** {#historias-de-usuario-difexa}

[**Historias de Usuario Difexa	1**](#historias-de-usuario-difexa)

[**Módulo de Autenticación y Gestión de Usuarios	3**](#módulo-de-autenticación-y-gestión-de-usuarios)

[H01: Registro de Usuario Invitado	3](#h01:-registro-de-usuario-invitado-\(emilio\))

[Criterios de aceptación	3](#criterios-de-aceptación)

[H02: Autenticación de usuario	4](#h02:-autenticación-de-usuario-\(emilio\))

[Criterios de aceptación	4](#criterios-de-aceptación-1)

[H02b: Recuperación de contraseña	5](#h02b:-recuperación-de-contraseña-\(emilio\))

[Criterios de aceptación	5](#criterios-de-aceptación-2)

[H03: Gestión de usuarios por administrador	5](#h03:-gestión-de-usuarios-por-administrador)

[Criterios de aceptación	5](#criterios-de-aceptación-3)

[H03b: Gestión de sesiones activas	6](#h03b:-gestión-de-sesiones-activas)

[Criterios de aceptación	6](#criterios-de-aceptación-4)

[H03c: Gestión de notificaciones del sistema	6](#h03c:-gestión-de-notificaciones-del-sistema)

[Criterios de aceptación	7](#criterios-de-aceptación-5)

[**Módulo de Gestión de Medios	7**](#módulo-de-gestión-de-medios)

[H04: Creación de medio de publicación	7](#h04:-creación-de-medio-de-publicación-\(federico\))

[Criterios de aceptación	7](#criterios-de-aceptación-6)

[H05: Modificación de medio de publicación	9](#h05:-modificación-de-medio-de-publicación-\(federico\))

[Criterios de aceptación	9](#criterios-de-aceptación-7)

[**Módulo de Gestión de Canales	9**](#módulo-de-gestión-de-canales)

[H06: Creación de canal de difusión	9](#h06:-creación-de-canal-de-difusión-\(diego\))

[Criterios de aceptación	9](#criterios-de-aceptación-8)

[H07: Asignación de canales a publicadores	9](#h07:-asignación-de-canales-a-publicadores-\(diego\))

[Criterios de aceptación	9](#criterios-de-aceptación-9)

[H08: Modificación de canal	10](#h08:-modificación-de-canal-\(diego\))

[Criterios de aceptación	10](#criterios-de-aceptación-10)

[**Módulo de Gestión de Publicaciones	10**](#módulo-de-gestión-de-publicaciones)

[H09: Creación de publicación	10](#h09:-creación-de-publicación-\(sol\))

[Criterios de aceptación	10](#criterios-de-aceptación-11)

[H10: Edición de publicación	10](#h10:-edición-de-publicación)

[Criterios de aceptación	10](#criterios-de-aceptación-12)

[H10b: Historial y versionado de publicaciones	11](#h10b:-historial-y-versionado-de-publicaciones)

[Criterios de aceptación	11](#criterios-de-aceptación-13)

[H11: Eliminación de publicación	12](#h11:-eliminación-de-publicación-\(sol\))

[Criterios de aceptación	12](#criterios-de-aceptación-14)

[H11b: Búsqueda y filtrado de publicaciones	12](#h11b:-búsqueda-y-filtrado-de-publicaciones)

[Criterios de aceptación	12](#criterios-de-aceptación-15)

[H11c: Gestión de archivos adjuntos	13](#h11c:-gestión-de-archivos-adjuntos)

[Criterios de aceptación	13](#criterios-de-aceptación-16)

[H12: Archivado de publicación	14](#h12:-archivado-de-publicación)

[Criterios de aceptación	14](#criterios-de-aceptación-17)

[**Módulo de Enriquecimiento por IA	14**](#módulo-de-enriquecimiento-por-ia)

[H13: Solicitud de enriquecimiento por IA	14](#h13:-solicitud-de-enriquecimiento-por-ia)

[Criterios de aceptación	15](#criterios-de-aceptación-18)

[H14: Revisión de contenido enriquecido	16](#h14:-revisión-de-contenido-enriquecido)

[Criterios de aceptación	16](#criterios-de-aceptación-19)

[**Módulo de Moderación	16**](#módulo-de-moderación)

[H15: Aprobación de publicaciones por moderador	16](#h15:-aprobación-de-publicaciones-por-moderador)

[Criterios de aceptación	16](#criterios-de-aceptación-20)

[H16: Detención de publicación en difusión	17](#h16:-detención-de-publicación-en-difusión)

[Criterios de aceptación	17](#criterios-de-aceptación-21)

[**Módulo de Distribución de Contenido	17**](#módulo-de-distribución-de-contenido)

[H17: Programación de publicaciones	17](#h17:-programación-de-publicaciones)

[Criterios de aceptación	17](#criterios-de-aceptación-22)

[H18: Difusión manual de contenido	17](#h18:-difusión-manual-de-contenido)

[Criterios de aceptación	17](#criterios-de-aceptación-23)

[H19: Consumo de publicaciones por difusores	17](#h19:-consumo-de-publicaciones-por-difusores)

[Criterios de aceptación	18](#criterios-de-aceptación-24)

[H20: Consulta de publicaciones para dispositivos cliente	18](#h20:-consulta-de-publicaciones-para-dispositivos-cliente)

[Criterios de aceptación	18](#criterios-de-aceptación-25)

[**Módulo de Seguridad y Permisos	18**](#módulo-de-seguridad-y-permisos)

[H21: Gestión de permisos por rol	18](#h21:-gestión-de-permisos-por-rol)

[Criterios de aceptación	18](#criterios-de-aceptación-26)

[H22: Cierre de sesión	18](#h22:-cierre-de-sesión)

[Criterios de aceptación	19](#criterios-de-aceptación-27)

[**Módulo de Gestión de Perfil	19**](#módulo-de-gestión-de-perfil)

[H23: Gestión de contexto semántico del usuario	19](#h23:-gestión-de-contexto-semántico-del-usuario)

[Criterios de aceptación	19](#criterios-de-aceptación-28)

[H24: Modificación de datos del perfil	19](#h24:-modificación-de-datos-del-perfil)

[Criterios de aceptación	19](#criterios-de-aceptación-29)

[H25: Cambio de contraseña	19](#h25:-cambio-de-contraseña)

[Criterios de aceptación	19](#criterios-de-aceptación-30)

[H26: Cambio de correo electrónico	20](#h26:-cambio-de-correo-electrónico)

[Criterios de aceptación	20](#criterios-de-aceptación-31)

[H27: Eliminación de cuenta	20](#h27:-eliminación-de-cuenta)

[Criterios de aceptación	20](#criterios-de-aceptación-32)

[**Módulo de Reportes y Analíticas	20**](#módulo-de-reportes-y-analíticas)

[H28: Reportes y estadísticas del sistema	20](#h28:-reportes-y-estadísticas-del-sistema)

[Criterios de aceptación	21](#criterios-de-aceptación-33)

[H29: Auditoría y logs del sistema	22](#h29:-auditoría-y-logs-del-sistema)

[Criterios de aceptación	22](#criterios-de-aceptación-34)

[**Módulo de Configuración del Sistema	23**](#módulo-de-configuración-del-sistema)

[H30: Configuración general del sistema	23](#h30:-configuración-general-del-sistema)

[Criterios de aceptación	23](#criterios-de-aceptación-35)

[**Requisitos No Funcionales Importantes	25**](#requisitos-no-funcionales-importantes)

[**ANEXO: Roles y Permisos del Sistema	25**](#anexo:-roles-y-permisos-del-sistema)

[Estados y Roles de Usuario	25](#estados-y-roles-de-usuario)

[Estados del Usuario	25](#estados-del-usuario)

[Roles del Sistema	25](#roles-del-sistema)

[Permisos por Rol	26](#permisos-por-rol)

[1\. Invitado	26](#1.-invitado)

[2\. Usuario Registrado	26](#2.-usuario-registrado)

[3\. Usuario Verificado	26](#3.-usuario-verificado)

[4\. Publicador	27](#4.-publicador)

[Gestión de Publicaciones	27](#gestión-de-publicaciones)

[Enriquecimiento por IA	27](#enriquecimiento-por-ia)

[Distribución	27](#distribución)

[Canales	27](#canales)

[Archivos	28](#archivos)

[Auditoría	28](#auditoría)

[5\. Moderador	28](#5.-moderador)

[Moderación de Publicaciones	28](#moderación-de-publicaciones)

[Gestión de Contenido	28](#gestión-de-contenido)

[Canales y Medios	28](#canales-y-medios)

[Auditoría	28](#auditoría-1)

[6\. Administrador	29](#6.-administrador)

[Gestión de Usuarios	29](#gestión-de-usuarios)

[Gestión de Medios	29](#gestión-de-medios)

[Gestión de Canales	29](#gestión-de-canales)

[Gestión de Permisos	30](#gestión-de-permisos)

[Configuración del Sistema	30](#configuración-del-sistema)

[Auditoría Completa	30](#auditoría-completa)

[7\. Difusor	30](#7.-difusor)

[8\. Dispositivo Cliente	31](#heading=h.8wgc2gkj4o0o)

[Matriz de Permisos por Funcionalidad	31](#matriz-de-permisos-por-funcionalidad)

[Flujo de Estados de Publicación	37](#flujo-de-estados-de-publicación)

[Descripción de Estados	37](#descripción-de-estados)

[Transiciones Permitidas	37](#transiciones-permitidas)

[Permisos Críticos del Sistema	38](#permisos-críticos-del-sistema)

[Implementación con Spatie Laravel Permission	38](#implementación-con-spatie-laravel-permission)

# **Módulo de Autenticación y Gestión de Usuarios** {#módulo-de-autenticación-y-gestión-de-usuarios}

## **H01: Registro de Usuario Invitado (emilio)** {#h01:-registro-de-usuario-invitado-(emilio)}

**COMO** usuario invitado **QUIERO** poder registrarme en el sistema **PARA QUE** pueda solicitar acceso para publicar contenido en los canales de la facultad.

### **Criterios de aceptación** {#criterios-de-aceptación}

1. El POST de registro debe contener:  
   1. Apellidos (mínimo 2 caracteres, máximo 100 caracteres, solo letras y espacios)  
   2. Nombres (mínimo 2 caracteres, máximo 100 caracteres, solo letras y espacios)  
   3. DNI (exactamente 8 dígitos numéricos para Perú, debe ser único en el sistema)  
   4. Correo electrónico (formato válido, máximo 255 caracteres)  
   5. Celular (10 dígitos, formato: \+51XXXXXXXXX o validación según país)  
   6. Canales (al menos 1 canal, máximo 5 canales seleccionables)  
   7. Contraseña (mínimo 8 caracteres, máximo 128 caracteres)  
   8. Confirmación de contraseña (debe coincidir exactamente con la contraseña)  
2. El sistema debe validar que el correo electrónico no esté registrado previamente.  
3. El sistema debe validar que el DNI no esté registrado previamente.  
4. La contraseña debe cumplir requisitos mínimos de seguridad:  
   1. Mínimo 8 caracteres  
   2. Al menos un número  
   3. Al menos una letra en mayúscula  
   4. Al menos una letra en minúscula  
   5. Opcionalmente, al menos un carácter especial (\!@\#$%^&\*)  
5. El sistema debe validar que los canales seleccionados existan y estén activos.  
6. Al completar el registro exitosamente:  
   1. El usuario queda en estado "Registrado".  
   2. El sistema informa al usuario que se encuentra "Registrado", y que debe verificar su email.  
   3. El sistema envía un correo de verificación con un enlace conteniendo el token de verificación único.  
   4. El token de verificación debe tener una validez de 48 horas.  
7. Al seleccionar el enlace de verificación:  
   1. El sistema valida que el token sea válido y no haya expirado.  
   2. El usuario quedará en estado "Verificado" y pendiente de aprobación administrativa.  
   3. El sistema envía una notificación a los administradores informando de la nueva solicitud.  
8. El sistema debe prevenir ataques de fuerza bruta limitando a 5 intentos de registro desde la misma IP en 10 minutos.  
9. Todos los datos deben ser sanitizados para prevenir inyección SQL y XSS.

## **H02: Autenticación de usuario (emilio)** {#h02:-autenticación-de-usuario-(emilio)}

**COMO** usuario Verificado **QUIERO** poder iniciar sesión en el sistema **PARA QUE** pueda acceder a las funcionalidades según mi rol asignado.

### **Criterios de aceptación** {#criterios-de-aceptación-1}

1. El sistema debe permitir el ingreso mediante correo electrónico y contraseña.  
2. El sistema debe generar y devolver un token de autenticación (Bearer Token) con tiempo de expiración de 24 horas.  
3. El sistema debe rechazar credenciales incorrectas con mensaje apropiado.  
4. El sistema debe impedir el acceso a usuarios no aprobados, informando su estado actual (Registrado, Verificado sin aprobar, Deshabilitado).  
5. El sistema debe bloquear temporalmente la cuenta después de 5 intentos fallidos consecutivos durante un período de 15 minutos.  
6. El sistema debe registrar cada intento de inicio de sesión (exitoso o fallido) con timestamp, IP y user agent.  
7. El token debe incluir información del rol y permisos del usuario para autorización.  
8. El sistema debe permitir múltiples sesiones activas desde diferentes dispositivos simultáneamente.

### **Rutas**

POST: /api/login

## **H02b: Recuperación de contraseña (emilio)** {#h02b:-recuperación-de-contraseña-(emilio)}

**COMO** usuario registrado que olvidó su contraseña **QUIERO** poder recuperar el acceso a mi cuenta **PARA QUE** pueda restablecer mi contraseña de forma segura.

### **Criterios de aceptación** {#criterios-de-aceptación-2}

1. El usuario debe poder solicitar un restablecimiento de contraseña ingresando su correo electrónico.  
2. El sistema debe validar que el correo electrónico exista en la base de datos antes de enviar el email.  
3. El sistema debe generar un token único de restablecimiento con tiempo de expiración de 1 hora.  
4. El sistema debe enviar un correo con un enlace conteniendo el token de restablecimiento.  
5. El enlace debe dirigirse a un formulario donde el usuario ingresa la nueva contraseña y su confirmación.  
6. La nueva contraseña debe cumplir los mismos requisitos de seguridad definidos en H01.  
7. El token debe ser de un solo uso y quedar invalidado después de su utilización.  
8. El sistema debe invalidar todos los tokens de restablecimiento previos al generar uno nuevo.  
9. El sistema debe notificar al usuario por correo cuando su contraseña ha sido restablecida exitosamente.  
10. Si el usuario no tiene cuenta, el sistema debe mostrar el mismo mensaje genérico ("Si el correo existe, recibirás un enlace de recuperación") para prevenir la enumeración de cuentas.

### **Rutas**

## **H03: Gestión de usuarios por administrador** {#h03:-gestión-de-usuarios-por-administrador}

**COMO** administrador **QUIERO** poder gestionar las cuentas de usuario **PARA QUE** pueda controlar quién tiene acceso al sistema y con qué permisos.

### **Criterios de aceptación** {#criterios-de-aceptación-3}

1. El administrador debe poder ver un listado paginado de todos los usuarios (paginación de 20, 50 o 100 registros por página).  
2. El administrador debe poder filtrar usuarios por:  
   1. Rol (Invitado, Publicador, Moderador, Administrador)  
   2. Estado (Registrado, Verificado, Aprobado, Deshabilitado, Eliminado)  
   3. Correo electrónico (búsqueda parcial)  
   4. Nombre completo (búsqueda parcial)  
   5. DNI  
   6. Fecha de registro (rango de fechas)  
   7. Último acceso (rango de fechas)  
3. El administrador debe poder ordenar el listado por: nombre, email, fecha de registro, último acceso, estado.  
4. El administrador debe poder aprobar o rechazar solicitudes de registro pendientes.  
5. Al rechazar una solicitud, el administrador debe poder incluir un motivo (campo opcional, máximo 500 caracteres).  
6. El administrador debe poder asignar o revocar roles a usuarios (Publicador, Moderador, Administrador).  
7. El administrador debe poder habilitar o deshabilitar cuentas de usuario existentes.  
8. Al deshabilitar una cuenta, todas las sesiones activas del usuario deben ser invalidadas inmediatamente.  
9. El sistema debe enviar notificación por correo cuando cambia el estado de aprobación de un usuario, incluyendo el motivo si fue rechazado.  
10. El administrador debe poder ver el historial de cambios de cada usuario (cambios de estado, rol, habilitación/deshabilitación).  
11. El sistema debe prevenir que un administrador se deshabilite o elimine a sí mismo.  
12. El sistema debe requerir confirmación antes de deshabilitar o eliminar un usuario.

## **H03b: Gestión de sesiones activas** {#h03b:-gestión-de-sesiones-activas}

**COMO** usuario autenticado **QUIERO** poder ver y administrar mis sesiones activas **PARA QUE** pueda cerrar sesión en dispositivos que ya no uso o detectar accesos no autorizados.

### **Criterios de aceptación** {#criterios-de-aceptación-4}

1. El usuario debe poder ver un listado de todas sus sesiones activas con:  
   1. Dispositivo/navegador (user agent parseado)  
   2. Dirección IP  
   3. Ubicación geográfica aproximada (basada en IP)  
   4. Fecha y hora del último acceso  
   5. Fecha y hora de inicio de sesión  
   6. Indicador de la sesión actual  
2. El usuario debe poder cerrar sesión individualmente en cualquier dispositivo excepto el actual.  
3. El usuario debe poder cerrar sesión en todos los dispositivos excepto el actual con una sola acción.  
4. Al cerrar una sesión remota, el token correspondiente debe ser invalidado inmediatamente.  
5. El sistema debe notificar al usuario por correo cuando se inicia sesión desde un nuevo dispositivo o ubicación inusual.  
6. El sistema debe mantener un registro de las últimas 10 sesiones (activas o cerradas) para auditoría.  
7. Las sesiones inactivas por más de 30 días deben ser automáticamente cerradas.

## **H03c: Gestión de notificaciones del sistema** {#h03c:-gestión-de-notificaciones-del-sistema}

**COMO** usuario autenticado **QUIERO** poder ver y administrar mis notificaciones **PARA QUE** esté informado sobre eventos importantes del sistema y pueda personalizar qué notificaciones recibo.

### **Criterios de aceptación** {#criterios-de-aceptación-5}

1. El usuario debe poder ver un centro de notificaciones con:  
   1. Listado de notificaciones recientes (últimas 50\)  
   2. Indicador visual de notificaciones no leídas  
   3. Contador de notificaciones no leídas  
   4. Filtro por tipo de notificación (asignación de canal, aprobación, rechazo, moderación, sistema)  
   5. Filtro por estado (leído/no leído)  
2. Cada notificación debe mostrar:  
   1. Tipo de notificación con ícono distintivo  
   2. Título breve  
   3. Descripción/mensaje  
   4. Fecha y hora  
   5. Estado de lectura  
   6. Enlace o acción relacionada (si aplica)  
3. El usuario debe poder marcar notificaciones individuales como leídas.  
4. El usuario debe poder marcar todas las notificaciones como leídas.  
5. El usuario debe poder eliminar notificaciones individuales.  
6. El usuario debe poder configurar preferencias de notificación:  
   1. Recibir notificaciones por email (sí/no por tipo)  
   2. Recibir notificaciones en la aplicación (sí/no por tipo)  
   3. Frecuencia de resúmenes por email (inmediato, diario, semanal, nunca)  
7. El sistema debe generar notificaciones para:  
   1. Asignación/revocación de canales  
   2. Aprobación/rechazo de cuenta  
   3. Cambio de rol  
   4. Publicación enviada a moderación  
   5. Publicación aprobada/rechazada por moderador  
   6. Comentarios del moderador en publicación  
   7. Inicio de sesión desde nuevo dispositivo  
   8. Cambio de contraseña o email exitoso  
   9. Publicación programada próxima a difundirse (24 horas antes)  
   10. Errores en difusión de publicación  
8. Las notificaciones deben ser eliminadas automáticamente después de 90 días.  
9. El sistema debe soportar notificaciones en tiempo real mediante WebSockets o polling.

# **Módulo de Gestión de Medios** {#módulo-de-gestión-de-medios}

## **H04: Creación de medio de publicación  (federico)**  {#h04:-creación-de-medio-de-publicación-(federico)}

**Como** administrador **quiero** poder crear y configurar medios de publicación **para que** los canales puedan distribuir contenido en pantallas físicas, redes sociales y plataformas editoriales.

### **Criterios de aceptación** {#criterios-de-aceptación-6}

1. El medio debe tener campos obligatorios:  
   1. Nombre único (3-100 caracteres)  
   2. Tipo de medio (selección única): Pantalla física, Facebook, Instagram, Twitter/X, LinkedIn, YouTube, TikTok, Portal Web, Blog, Newsletter, Otro  
   3. Estado inicial (activo/inactivo)  
2. El medio debe tener configuración específica según el tipo:  
   **Para pantallas físicas:**  
   1. Resolución (ancho x alto en pixels)  
   2. Orientación (horizontal/vertical)  
   3. Ubicación física (texto descriptivo)  
   4. Tiempo de visualización por contenido (segundos)  
   5. Tasa de refresco (minutos)  
      **Para redes sociales:**  
   6. Nombre de la cuenta/página  
   7. URL del perfil  
   8. Credenciales API (API key, secret, tokens)  
   9. Límites de caracteres (según plataforma)  
   10. Formatos de imagen permitidos  
   11. Formatos de video permitidos  
   12. Hashtags predeterminados (opcional)  
       **Para plataformas editoriales:**  
   13. URL del sitio  
   14. Endpoint de API  
   15. Método de autenticación (API key, OAuth, JWT)  
   16. Credenciales  
   17. Formato de publicación (HTML, Markdown, plain text)  
3. El sistema debe permitir añadir contexto semántico (texto libre, 50-2000 caracteres) que describa:  
   1. Audiencia objetivo del medio  
   2. Estilo y tono de comunicación  
   3. Restricciones o guías editoriales  
   4. Palabras clave o temas relevantes  
4. El sistema debe permitir configurar:  
   1. URL de webhook para notificaciones de eventos  
   2. URL de callback para confirmación de difusión  
   3. Timeout para solicitudes (5-300 segundos)  
   4. Reintentos automáticos en caso de fallo (0-5)  
5. El sistema debe validar:  
   1. Que el nombre del medio sea único (case-insensitive)  
   2. Formato válido de URLs  
   3. Formato válido de credenciales según el tipo de medio  
   4. Valores numéricos en rangos válidos (resolución \> 0, tiempo \> 0, etc.)  
6. El sistema debe permitir:  
   1. Activar o desactivar medios sin eliminarlos  
   2. Medios inactivos no deben aparecer en selección de publicadores  
   3. Al desactivar, notificar a administradores si hay publicaciones programadas para ese medio  
7. El medio creado debe estar disponible inmediatamente para:  
   1. Asociación a canales por administradores  
   2. Aparecer en listados de medios  
   3. Ser asignado a difusores  
8. El sistema debe encriptar credenciales sensibles (API keys, secrets) antes de almacenarlas.  
9. El sistema debe registrar en auditoría: quién creó el medio, cuándo y con qué configuración inicial.  
10. El sistema debe validar credenciales de APIs externas (Facebook, Twitter, etc.) mediante una solicitud de prueba antes de guardar.

## **H05: Modificación de medio de publicación (federico)** {#h05:-modificación-de-medio-de-publicación-(federico)}

**Como** administrador **quiero** poder modificar la configuración de los medios **para que** pueda actualizar credenciales, parámetros técnicos o contexto semántico.

### **Criterios de aceptación** {#criterios-de-aceptación-7}

1. El sistema debe permitir editar nombre, tipo y configuración del medio.  
2. El sistema debe permitir actualizar el contexto semántico para el modelo de IA.  
3. El sistema debe permitir modificar el estado activo/inactivo del medio.  
4. El sistema debe registrar quién realizó la última modificación y cuándo.  
5. Los cambios deben aplicarse a todas las publicaciones futuras, no a las ya procesadas.

# **Módulo de Gestión de Canales** {#módulo-de-gestión-de-canales}

## **H06: Creación de canal de difusión (Diego)** {#h06:-creación-de-canal-de-difusión-(diego)}

**Como** administrador **quiero** poder crear canales temáticos de difusión **para que** las publicaciones puedan categorizarse y dirigirse al público adecuado.

### **Criterios de aceptación** {#criterios-de-aceptación-8}

1. El canal debe tener:  
   1. Nombre único.  
   2. Descripción.  
2. El sistema debe permitir asociar uno o múltiples medios de publicación al canal (pantallas, redes sociales, plataformas).  
3. El sistema debe permitir añadir un texto contextual para guiar al modelo de IA en la generación de contenido.  
4. El sistema debe validar que el nombre del canal sea único.  
5. El canal creado debe estar disponible inmediatamente para asignación a publicadores.

## **H07: Asignación de canales a publicadores (Diego)** {#h07:-asignación-de-canales-a-publicadores-(diego)}

**Como** administrador **quiero** poder asignar canales específicos a usuarios publicadores **para que** solo puedan gestionar contenido en las áreas autorizadas.

### **Criterios de aceptación** {#criterios-de-aceptación-9}

1. El sistema debe mostrar una lista de canales disponibles y usuarios con rol publicador.  
2. El sistema debe permitir seleccionar múltiples canales para un mismo publicador.  
3. El sistema debe permitir revocar acceso a canales previamente asignados.  
4. El publicador debe recibir una notificación cuando se le asigna o revoca acceso a un canal.  
5. Los cambios en asignaciones deben aplicarse inmediatamente sin necesidad de reiniciar sesión.

## **H08: Modificación de canal (Diego)** {#h08:-modificación-de-canal-(diego)}

**Como** administrador **quiero** poder modificar la configuración de los canales **para que** pueda adaptar su funcionamiento según necesidades cambiantes.

### **Criterios de aceptación** {#criterios-de-aceptación-10}

1. El sistema debe permitir editar nombre, descripción y tipo de canal existente.  
2. El sistema debe permitir actualizar el texto contextual para el modelo de IA.  
3. El sistema debe permitir modificar los medios de publicación asociados.  
4. El sistema debe registrar quién realizó la última modificación y cuándo.  
5. Los cambios deben aplicarse a todas las publicaciones futuras, no a las ya procesadas.

# **Módulo de Gestión de Publicaciones** {#módulo-de-gestión-de-publicaciones}

## **H09: Creación de publicación (Sol)** {#h09:-creación-de-publicación-(sol)}

**Como** publicador **quiero** poder crear una nueva publicación **para que** pueda compartir información relevante en los canales autorizados.

### **Criterios de aceptación** {#criterios-de-aceptación-11}

1. El sistema debe permitir ingresar título, contenido, y adjuntar archivos multimedia (imágenes, videos).  
2. El sistema debe permitir seleccionar uno o varios canales (solo entre los autorizados al publicador).  
3. El sistema debe permitir seleccionar los medios de publicación específicos para cada canal seleccionado.  
4. El sistema debe permitir programar la fecha y hora de publicación.  
5. El sistema debe guardar la publicación en estado "borrador" hasta que se solicite el enriquecimiento por IA.

## **H10: Edición de publicación** {#h10:-edición-de-publicación}

**Como** publicador **quiero** poder editar mis publicaciones existentes **para que** pueda corregir errores o actualizar información antes de su difusión.

### **Criterios de aceptación** {#criterios-de-aceptación-12}

1. El sistema debe permitir editar todos los campos de una publicación en estado "draft":  
   1. Título  
   2. Contenido  
   3. Canales seleccionados  
   4. Medios seleccionados por canal  
   5. Fecha y hora programada  
   6. Archivos adjuntos  
2. El sistema debe permitir modificar canales y medios seleccionados, respetando los canales autorizados al publicador.  
3. El sistema debe permitir cambiar la fecha programada si aún no ha sido difundida.  
4. El sistema debe permitir edición limitada de publicaciones en estado "publishing":  
   1. Solo puede cancelar el proceso de enriquecimiento  
   2. No puede editar contenido ni campos mientras está procesando  
   3. Al cancelar, vuelve a estado "draft" y permite edición completa  
5. El sistema NO debe permitir editar publicaciones en estado "scheduled" directamente:  
   1. Debe requerir primero volver a estado "draft" (acción explícita)  
   2. Al volver a "draft", se eliminan las versiones enriquecidas aprobadas  
   3. Requiere nuevo proceso de enriquecimiento y moderación  
6. El sistema debe prevenir la edición concurrente (optimistic locking):  
   1. Si dos usuarios intentan editar simultáneamente, el segundo debe recibir advertencia  
   2. Mostrar quién está editando actualmente y desde cuándo  
   3. Permitir "forzar edición" solo a moderadores y administradores  
7. El sistema debe registrar el historial de cambios incluyendo:  
   1. Usuario que realizó el cambio  
   2. Fecha y hora del cambio  
   3. Campos modificados (antes y después)  
   4. Dirección IP del usuario  
   5. Motivo del cambio (campo opcional)  
8. El sistema debe mantener las últimas 20 versiones de cada publicación para auditoría.  
9. El sistema debe autoguardar el progreso cada 30 segundos mientras el usuario edita (draft mode).

## **H10b: Historial y versionado de publicaciones** {#h10b:-historial-y-versionado-de-publicaciones}

**COMO** publicador, moderador o administrador **QUIERO** poder ver el historial completo de cambios de una publicación **PARA QUE** pueda auditar modificaciones y restaurar versiones anteriores si es necesario.

### **Criterios de aceptación** {#criterios-de-aceptación-13}

1. El sistema debe mantener un historial completo de:  
   1. Todas las ediciones realizadas en la publicación  
   2. Cambios de estado (draft → publishing → scheduled → archived)  
   3. Asignaciones y desasignaciones de canales/medios  
   4. Comentarios de moderadores  
   5. Aprobaciones y rechazos  
   6. Solicitudes de enriquecimiento  
   7. Archivos adjuntos agregados/eliminados  
   8. Programaciones y reprogramaciones  
2. Cada entrada del historial debe incluir:  
   1. Fecha y hora exacta (timestamp)  
   2. Usuario que realizó la acción  
   3. Tipo de acción (creación, edición, cambio de estado, etc.)  
   4. Detalles específicos del cambio (diff)  
   5. IP y dispositivo desde donde se realizó  
3. El sistema debe permitir:  
   1. Ver el historial completo ordenado cronológicamente  
   2. Filtrar por tipo de acción  
   3. Filtrar por usuario  
   4. Filtrar por rango de fechas  
   5. Comparar dos versiones específicas (diff visual)  
4. Para publicadores:  
   1. Solo pueden ver el historial de sus propias publicaciones  
   2. Pueden restaurar versiones anteriores solo en estado "draft"  
5. Para moderadores y administradores:  
   1. Pueden ver el historial completo de cualquier publicación  
   2. Pueden restaurar versiones de publicaciones en cualquier estado  
   3. La restauración de una publicación "scheduled" requiere confirmación y nueva moderación  
6. El sistema debe permitir exportar el historial en formato PDF o CSV.  
7. Al restaurar una versión anterior:  
   1. La publicación debe volver a estado "draft"  
   2. Se debe crear una nueva entrada en el historial indicando la restauración  
   3. Las versiones enriquecidas se eliminan y requieren nuevo proceso  
8. El historial debe ser inmutable (no editable ni eliminable).  
9. El sistema debe retener el historial completo por al menos 2 años para cumplimiento regulatorio.

## **H11: Eliminación de publicación (Sol)** {#h11:-eliminación-de-publicación-(sol)}

**Como** publicador **quiero** poder eliminar publicaciones **para que** pueda descartar contenido obsoleto o incorrecto.

### **Criterios de aceptación** {#criterios-de-aceptación-14}

1. El sistema debe permitir eliminar publicaciones en cualquier estado excepto "publishing" y "archived".  
2. El sistema debe solicitar confirmación antes de eliminar definitivamente.  
3. El sistema debe permitir a los **administradores** y **moderadores** eliminar cualquier publicación.  
4. El sistema debe mantener un registro de publicaciones eliminadas para auditoría.  
5. El sistema debe notificar si la eliminación no es posible por restricciones del estado actual.

## **H11b: Búsqueda y filtrado de publicaciones** {#h11b:-búsqueda-y-filtrado-de-publicaciones}

**COMO** publicador, moderador o administrador **QUIERO** poder buscar y filtrar publicaciones **PARA QUE** pueda encontrar rápidamente contenido específico.

### **Criterios de aceptación** {#criterios-de-aceptación-15}

1. El sistema debe permitir búsqueda por texto libre que coincida con:  
   1. Título de la publicación  
   2. Contenido de la publicación  
   3. Nombre del autor  
   4. Comentarios del moderador  
2. El sistema debe permitir filtrar publicaciones por:  
   1. Estado (draft, publishing, scheduled, archived)  
   2. Tipo de contenido (texto, imagen, video, audio, multimedia)  
   3. Canal (múltiple selección)  
   4. Medio (múltiple selección)  
   5. Autor (búsqueda por nombre o selección)  
   6. Fecha de creación (rango de fechas)  
   7. Fecha programada (rango de fechas)  
   8. Fecha de publicación (rango de fechas)  
   9. Con/sin archivos adjuntos  
   10. Con/sin enriquecimiento pendiente  
3. El sistema debe permitir ordenar resultados por:  
   1. Fecha de creación (ascendente/descendente)  
   2. Fecha de modificación (ascendente/descendente)  
   3. Fecha programada (ascendente/descendente)  
   4. Título (alfabético)  
   5. Estado  
   6. Autor  
4. Los resultados deben mostrarse paginados (20, 50 o 100 por página).  
5. El publicador solo debe poder buscar y filtrar sus propias publicaciones y las de sus canales asignados.  
6. El moderador y administrador debe poder buscar en todas las publicaciones del sistema.  
7. El sistema debe mostrar el número total de resultados encontrados.  
8. El sistema debe permitir aplicar múltiples filtros simultáneamente.  
9. El sistema debe permitir guardar combinaciones de filtros como "vistas personalizadas" para uso frecuente.  
10. La búsqueda debe completarse en menos de 2 segundos para conjuntos de hasta 10,000 publicaciones.

## **H11c: Gestión de archivos adjuntos** {#h11c:-gestión-de-archivos-adjuntos}

**COMO** publicador **QUIERO** poder adjuntar, gestionar y eliminar archivos multimedia en mis publicaciones **PARA QUE** pueda enriquecer el contenido con imágenes, videos y otros recursos.

### **Criterios de aceptación** {#criterios-de-aceptación-16}

1. El sistema debe permitir adjuntar archivos con las siguientes restricciones:  
   1. Imágenes: JPG, PNG, GIF, WEBP (máximo 10 MB cada una)  
   2. Videos: MP4, AVI, MOV, WEBM (máximo 100 MB cada uno)  
   3. Audio: MP3, WAV, OGG (máximo 20 MB cada uno)  
   4. Documentos: PDF (máximo 25 MB cada uno)  
   5. Máximo 10 archivos por publicación  
   6. Tamaño total máximo de 200 MB por publicación  
2. El sistema debe validar el tipo de archivo por contenido (MIME type), no solo por extensión.  
3. Durante la carga, el sistema debe mostrar:  
   1. Barra de progreso de carga  
   2. Posibilidad de cancelar la carga  
   3. Validación en tiempo real de tipo y tamaño  
4. Los archivos cargados deben ser:  
   1. Almacenados de forma segura en storage cloud (S3 o similar)  
   2. Asignados con URL pública o signed URL con expiración  
   3. Optimizados automáticamente (compresión de imágenes, transcoding de video si necesario)  
   4. Escaneados por antivirus antes de aceptarlos  
5. El sistema debe generar automáticamente:  
   1. Miniaturas para imágenes (200x200px, 800x600px)  
   2. Miniaturas para videos (frame del segundo 1\)  
   3. Metadatos: tamaño, dimensiones, duración (video/audio), formato  
6. El usuario debe poder:  
   1. Ver todos los archivos adjuntos con previsualización  
   2. Eliminar archivos adjuntos (solo en estado draft)  
   3. Ordenar archivos (establecer orden de visualización)  
   4. Establecer un archivo como "principal" o "portada"  
   5. Añadir texto alternativo (alt text) para accesibilidad  
   6. Añadir descripción/caption a cada archivo  
7. Al eliminar una publicación, todos sus archivos adjuntos deben ser marcados para eliminación (soft delete) y eliminados físicamente después de 30 días.  
8. El sistema debe implementar rate limiting: máximo 20 archivos subidos por usuario por hora.  
9. El sistema debe registrar todas las operaciones de carga y eliminación de archivos para auditoría.  
10. El sistema debe soportar carga múltiple (drag & drop de múltiples archivos simultáneamente).

## **H12: Archivado de publicación** {#h12:-archivado-de-publicación}

**Como** publicador o moderador **quiero** poder archivar publicaciones **para que** el contenido obsoleto o vencido no aparezca en las búsquedas activas pero se conserve para auditoría.

### **Criterios de aceptación** {#criterios-de-aceptación-17}

1. El sistema debe permitir archivar publicaciones en estado "scheduled" o "publishing".  
2. El sistema debe solicitar confirmación antes de archivar.  
3. Las publicaciones archivadas deben cambiar al estado "archived".  
4. Las publicaciones archivadas no deben aparecer en listados activos ni ser procesadas para difusión.  
5. El sistema debe registrar quién archivó la publicación y cuándo.  
6. Los administradores y moderadores deben poder restaurar publicaciones archivadas.

# **Módulo de Enriquecimiento por IA** {#módulo-de-enriquecimiento-por-ia}

## **H13: Solicitud de enriquecimiento por IA** {#h13:-solicitud-de-enriquecimiento-por-ia}

**Como** publicador **quiero** poder solicitar el enriquecimiento automático de mi contenido **para que** se generen versiones adaptadas a cada medio de publicación seleccionado.

### **Criterios de aceptación** {#criterios-de-aceptación-18}

1. El sistema debe validar antes de enviar a enriquecimiento:  
   1. La publicación debe estar en estado "draft"  
   2. Debe tener al menos un canal y medio seleccionados  
   3. El contenido debe tener al menos 10 caracteres  
   4. Si tiene archivos adjuntos, deben estar completamente cargados  
2. El sistema debe enviar al servicio externo de IA:  
   1. Contenido original de la publicación  
   2. Contexto semántico del usuario (autor)  
   3. Contexto semántico de cada canal seleccionado  
   4. Contexto semántico de cada medio seleccionado  
   5. Tipo de contenido (texto, imagen, vídeo, etc.)  
   6. Metadatos de archivos adjuntos  
   7. Configuración específica de cada medio (resolución, orientación, límites de caracteres)  
3. El sistema debe cambiar el estado de la publicación a "publishing" durante el procesamiento.  
4. El sistema debe indicar claramente el estado de procesamiento:  
   1. "Enviando solicitud..."  
   2. "Procesando enriquecimiento..." (con spinner o animación)  
   3. "Generando versión para \[nombre del medio\]..." (progreso por medio)  
   4. Porcentaje de completitud estimado  
   5. Tiempo estimado restante  
5. El sistema debe establecer un timeout de 5 minutos por cada versión generada:  
   1. Si excede el tiempo, marcar esa versión como fallida  
   2. Continuar con los demás medios  
   3. Permitir reintentar solo las versiones fallidas  
6. El sistema debe notificar al usuario:  
   1. En tiempo real mediante WebSocket si está conectado  
   2. Por email cuando el enriquecimiento esté completo  
   3. Push notification en la aplicación  
7. El sistema debe manejar errores:  
   1. Error de conexión: reintentar automáticamente hasta 3 veces con backoff exponencial  
   2. Error de servicio externo (500): mostrar mensaje y permitir reintento manual  
   3. Error de contenido inapropiado: notificar al usuario y marcar para revisión  
   4. Error de cuota excedida: notificar al administrador y poner en cola  
   5. Registrar todos los errores en logs con detalles técnicos  
8. El sistema debe permitir cancelar el proceso:  
   1. Botón "Cancelar enriquecimiento" visible durante el procesamiento  
   2. Al cancelar, detener inmediatamente las solicitudes pendientes  
   3. Eliminar versiones parciales generadas  
   4. Volver el estado de la publicación a "draft"  
   5. Registrar la cancelación en el historial  
9. El sistema debe implementar rate limiting:  
   1. Máximo 10 solicitudes de enriquecimiento por usuario por hora  
   2. Máximo 100 solicitudes por organización por día  
   3. Mostrar mensaje claro cuando se alcance el límite  
10. El sistema debe guardar las versiones generadas con:  
    1. Contenido enriquecido  
    2. Timestamp de generación  
    3. Modelo de IA utilizado y versión  
    4. Tokens consumidos (para auditoría de costos)  
    5. Estado (pending, success, failed)  
11. El sistema debe calcular y mostrar el costo estimado de la solicitud antes de enviar (basado en tokens esperados).

## **H14: Revisión de contenido enriquecido** {#h14:-revisión-de-contenido-enriquecido}

**Como** publicador **quiero** poder revisar las versiones enriquecidas generadas por IA **para que** pueda aprobarlas, modificarlas o rechazarlas antes de su difusión.

### **Criterios de aceptación** {#criterios-de-aceptación-19}

1. El sistema debe mostrar claramente la versión original y cada versión generada por la IA.  
2. El sistema debe permitir aprobar, rechazar o solicitar regeneración individual de cada versión.  
3. El sistema debe permitir editar manualmente el contenido generado antes de aprobar.  
4. El sistema debe permitir aprobar todas las versiones con una sola acción si el usuario lo desea.  
5. El sistema debe guardar un historial de las diferentes versiones generadas para cada publicación.

# **Módulo de Moderación** {#módulo-de-moderación}

## **H15: Aprobación de publicaciones por moderador** {#h15:-aprobación-de-publicaciones-por-moderador}

**Como** moderador **quiero** poder revisar y aprobar o rechazar publicaciones antes de su difusión **para que** se garantice la calidad y pertinencia del contenido institucional.

### **Criterios de aceptación** {#criterios-de-aceptación-20}

1. El sistema debe mostrar un listado de publicaciones pendientes de moderación (estado "publishing").  
2. El sistema debe permitir al moderador ver el contenido original y todas las versiones enriquecidas.  
3. El sistema debe permitir aprobar la publicación para que pase a difusión.  
4. El sistema debe permitir rechazar la publicación con comentarios obligatorios para el publicador.  
5. Al aprobar, la publicación debe cambiar a estado "scheduled" si tiene fecha programada, o iniciar difusión inmediata.  
6. Al rechazar, la publicación debe volver a estado "draft" para correcciones del publicador.  
7. El sistema debe notificar al publicador sobre la decisión del moderador.  
8. El sistema debe registrar quién moderó la publicación, cuándo y qué decisión tomó.

## **H16: Detención de publicación en difusión** {#h16:-detención-de-publicación-en-difusión}

**Como** moderador o publicador **quiero** poder detener una publicación que está en proceso de difusión **para que** pueda corregir errores detectados después del inicio de la distribución.

### **Criterios de aceptación** {#criterios-de-aceptación-21}

1. El sistema debe permitir detener publicaciones en estado "publishing".  
2. El sistema debe solicitar confirmación y motivo antes de detener la difusión.  
3. Al detener, el sistema debe cambiar el estado de la publicación a "draft".  
4. El sistema debe registrar quién detuvo la publicación, cuándo y por qué motivo.  
5. El sistema debe permitir editar la publicación detenida antes de volver a enviarla a difusión.  
6. El sistema debe notificar a los medios correspondientes sobre la detención (si aplica).

# **Módulo de Distribución de Contenido** {#módulo-de-distribución-de-contenido}

## **H17: Programación de publicaciones** {#h17:-programación-de-publicaciones}

**Como** publicador **quiero** poder programar la fecha y hora de publicación **para que** el contenido se difunda en el momento más oportuno.

### **Criterios de aceptación** {#criterios-de-aceptación-22}

1. El sistema debe permitir seleccionar fecha y hora específicas para la difusión automática.  
2. El sistema debe validar que la fecha programada sea futura.  
3. El sistema debe permitir programar publicaciones pendientes.  
4. El sistema debe ejecutar automáticamente la difusión en el momento programado.  
5. El sistema debe mostrar claramente el estado de programación de cada publicación.

## **H18: Difusión manual de contenido** {#h18:-difusión-manual-de-contenido}

**Como** publicador **quiero** poder difundir inmediatamente una publicación aprobada **para que** el contenido urgente llegue sin demora a los medios seleccionados.

### **Criterios de aceptación** {#criterios-de-aceptación-23}

1. El sistema debe permitir difundir manualmente una publicación que tenga todas sus versiones aprobadas por moderación.  
2. El sistema debe confirmar la acción antes de proceder con la difusión inmediata.  
3. El sistema debe cambiar el estado a "publishing" durante la distribución.  
4. El sistema debe notificar el éxito o fallo en cada medio de difusión seleccionado.  
5. El sistema debe registrar la hora exacta de difusión y el usuario que la ejecutó.  
6. El sistema debe actualizar el estado de la publicación a "scheduled" tras completar el proceso.

## **H19: Consumo de publicaciones por difusores** {#h19:-consumo-de-publicaciones-por-difusores}

**Como** difusor (agente automatizado) **quiero** poder consumir publicaciones aprobadas y distribuirlas en el medio asignado **para que** el contenido llegue a las pantallas físicas, redes sociales o plataformas editoriales correspondientes.

### **Criterios de aceptación** {#criterios-de-aceptación-24}

1. El sistema debe autenticar al difusor mediante su token único.  
2. El sistema debe devolver solo publicaciones en estado "scheduled" asignadas al medio del difusor.  
3. El sistema debe incluir la versión enriquecida específica para el medio del difusor.  
4. El sistema debe incluir todos los recursos multimedia necesarios o sus URLs de acceso.  
5. El sistema debe registrar cada consulta y difusión exitosa para análisis y auditoría.  
6. El sistema debe permitir al difusor reportar el estado de la difusión (éxito, fallo, parcial).  
7. El sistema debe actualizar el estado de distribución por medio de la publicación.

## **H20: Consulta de publicaciones para dispositivos cliente** {#h20:-consulta-de-publicaciones-para-dispositivos-cliente}

**Como** dispositivo cliente **quiero** poder obtener las publicaciones correspondientes a mi pantalla **para que** pueda mostrarlas en los espacios físicos de la facultad.

### **Criterios de aceptación** {#criterios-de-aceptación-25}

1. El sistema debe autenticar al dispositivo mediante su token único.  
2. El sistema debe devolver solo publicaciones en estado "scheduled" asignadas al medio asociado al dispositivo.  
3. El sistema debe filtrar las publicaciones según los canales configurados para el dispositivo.  
4. El sistema debe incluir todos los recursos multimedia necesarios o sus URLs de acceso.  
5. El sistema debe registrar las consultas exitosas para análisis de disponibilidad.  
6. El sistema debe actualizar la fecha de última consulta del dispositivo.

# **Módulo de Seguridad y Permisos** {#módulo-de-seguridad-y-permisos}

## **H21: Gestión de permisos por rol** {#h21:-gestión-de-permisos-por-rol}

**Como** administrador **quiero** poder definir permisos específicos para cada rol **para que** pueda implementar un control de acceso granular según responsabilidades.

### **Criterios de aceptación** {#criterios-de-aceptación-26}

1. El sistema debe mostrar una matriz de roles y permisos disponibles.  
2. El sistema debe permitir asignar o revocar permisos específicos a cada rol.  
3. El sistema debe aplicar los cambios de permisos inmediatamente a todos los usuarios con ese rol.  
4. El sistema debe impedir que se eliminen permisos críticos para el funcionamiento del sistema.  
5. El sistema debe registrar quién realizó cambios en los permisos y cuándo.

## **H22: Cierre de sesión** {#h22:-cierre-de-sesión}

**Como** usuario autenticado **quiero** poder cerrar sesión en el sistema **para que** mi sesión no quede activa en dispositivos compartidos.

### **Criterios de aceptación** {#criterios-de-aceptación-27}

1. El sistema debe invalidar el token de autenticación actual al cerrar sesión.  
2. El sistema debe confirmar visualmente que la sesión se cerró correctamente.  
3. El sistema debe redireccionar al usuario a la pantalla de inicio de sesión.  
4. El sistema debe registrar la fecha y hora del cierre de sesión.  
5. El sistema debe impedir el acceso a recursos protegidos con el token invalidado.

# **Módulo de Gestión de Perfil** {#módulo-de-gestión-de-perfil}

## **H23: Gestión de contexto semántico del usuario** {#h23:-gestión-de-contexto-semántico-del-usuario}

**Como** usuario Verificado **quiero** poder definir y actualizar mi contexto semántico **para que** el modelo de IA genere contenido coherente con mi estilo comunicacional y objetivos.

### **Criterios de aceptación** {#criterios-de-aceptación-28}

1. El sistema debe permitir al usuario ingresar o editar su contexto semántico (texto libre).  
2. El sistema debe sugerir plantillas de contexto según el rol del usuario.  
3. El contexto semántico debe incluir información sobre estilo, tono, audiencia objetivo y preferencias.  
4. El sistema debe validar que el contexto tenga al menos 50 caracteres.  
5. El sistema debe enviar este contexto junto con el del canal y medio al servicio de IA.  
6. El sistema debe permitir previsualizar cómo afectará el contexto a las generaciones de IA.

## **H24: Modificación de datos del perfil** {#h24:-modificación-de-datos-del-perfil}

**COMO** usuario Verificado, **QUIERO** poder modificar mis datos personales y mi imagen de perfil, **PARA QUE** pueda mantener mi información actualizada y personalizar mi identificación en el sistema.

### **Criterios de aceptación** {#criterios-de-aceptación-29}

1. El sistema debe permitir al usuario editar sus Nombres, Apellidos y Número de Celular.  
2. El DNI y el correo electrónico no deben ser modificables desde esta opción.  
3. El sistema debe permitir al usuario subir, cambiar o eliminar su imagen de perfil (avatar).  
4. Se debe validar el formato del archivo de imagen (ej. JPG, PNG).  
5. Se debe establecer un límite de tamaño para el archivo (ej. 5 MB).  
6. El sistema debe confirmar la actualización exitosa mediante un mensaje.

## **H25: Cambio de contraseña** {#h25:-cambio-de-contraseña}

**Como** usuario Verificado, **quiero** poder cambiar mi contraseña, **para que** pueda mantener la seguridad de mi cuenta de forma periódica o si sospecho que ha sido comprometida.

### **Criterios de aceptación** {#criterios-de-aceptación-30}

1. El formulario debe solicitar la contraseña actual, la nueva contraseña y la confirmación de la nueva contraseña.  
2. El sistema debe validar que la contraseña actual sea correcta.  
3. La nueva contraseña debe cumplir con los requisitos de seguridad definidos en la historia H01 (8 caracteres, mayúscula, minúscula, número).  
4. El sistema debe validar que la nueva contraseña no sea igual a la actual.  
5. Tras un cambio exitoso, el sistema debe enviar una notificación por correo electrónico al usuario informando sobre el cambio.  
6. (Opcional de seguridad) Tras el cambio, el sistema puede invalidar las sesiones activas en otros dispositivos.

## **H26: Cambio de correo electrónico** {#h26:-cambio-de-correo-electrónico}

**Como** usuario Verificado, **quiero** poder solicitar el cambio de mi correo electrónico asociado a la cuenta, **para que** pueda migrar mi cuenta a una nueva dirección de correo si es necesario.

### **Criterios de aceptación** {#criterios-de-aceptación-31}

1. El usuario debe ingresar su contraseña actual para iniciar el proceso de cambio.  
2. El usuario debe proporcionar la nueva dirección de correo electrónico.  
3. El sistema debe validar que el nuevo correo no esté registrado por otro usuario.  
4. El sistema debe enviar un enlace de verificación a la nueva dirección de correo electrónico. El cambio no será efectivo hasta que se haga clic en dicho enlace.  
5. Mientras el nuevo correo no sea verificado, el correo original seguirá siendo válido para el inicio de sesión y las notificaciones.  
6. Una vez verificado el nuevo correo, este reemplazará al anterior para el inicio de sesión y el sistema enviará una notificación a ambas direcciones de correo informando del cambio completado.

## **H27: Eliminación de cuenta** {#h27:-eliminación-de-cuenta}

**Como** usuario Verificado, **quiero** poder eliminar mi cuenta de forma definitiva, **para que** mi información personal sea borrada del sistema si ya no deseo utilizarlo.

### **Criterios de aceptación** {#criterios-de-aceptación-32}

1. El sistema debe solicitar al usuario que confirme la acción ingresando su contraseña actual.  
2. El sistema debe mostrar una advertencia clara sobre que la eliminación es permanente e irreversible.  
3. Una vez confirmada, la cuenta del usuario se desactiva inmediatamente y se marca para eliminación.  
4. El sistema debe invalidar el token de autenticación y cerrar la sesión del usuario.  
5. Las publicaciones o contenido creado por el usuario no serán eliminados para mantener la integridad del sistema, pero se desvincularán del usuario (ej. mostrando "Autor: Usuario eliminado").

# **Módulo de Reportes y Analíticas** {#módulo-de-reportes-y-analíticas}

## **H28: Reportes y estadísticas del sistema** {#h28:-reportes-y-estadísticas-del-sistema}

**COMO** administrador o moderador **QUIERO** poder visualizar reportes y estadísticas del uso del sistema **PARA QUE** pueda tomar decisiones informadas sobre gestión de contenido y usuarios.

### **Criterios de aceptación** {#criterios-de-aceptación-33}

1. El sistema debe proporcionar un dashboard con métricas generales:  
   1. Número total de usuarios (por rol y estado)  
   2. Número total de publicaciones (por estado)  
   3. Número de publicaciones por canal  
   4. Número de publicaciones por medio  
   5. Publicaciones creadas en los últimos 7, 30 y 90 días (gráfico de línea temporal)  
   6. Tasa de aprobación vs rechazo de publicaciones  
   7. Tiempo promedio de moderación  
   8. Usuarios más activos (top 10\)  
   9. Canales más utilizados  
   10. Medios más utilizados  
2. El sistema debe permitir generar reportes específicos:  
   1. **Reporte de actividad de usuarios**: publicaciones creadas, editadas, aprobadas por usuario en un período  
   2. **Reporte de moderación**: publicaciones moderadas, tiempo de respuesta, tasa de rechazo por moderador  
   3. **Reporte de publicaciones por canal**: volumen, tipos de contenido, performance por canal  
   4. **Reporte de uso de IA**: solicitudes de enriquecimiento, tasa de éxito, tokens consumidos, costos estimados  
   5. **Reporte de difusión**: publicaciones difundidas, medios alcanzados, éxitos y fallos  
   6. **Reporte de archivos**: tamaño total almacenado, tipos de archivo más comunes, usuarios con mayor uso de storage  
3. Cada reporte debe permitir:  
   1. Seleccionar rango de fechas personalizado  
   2. Filtrar por canal, medio, usuario, estado  
   3. Exportar en formatos CSV, PDF y Excel  
   4. Programar envío automático por email (diario, semanal, mensual)  
   5. Visualización con gráficos interactivos (barras, líneas, torta)  
4. El sistema debe calcular métricas de performance:  
   1. Tiempo promedio desde creación hasta aprobación  
   2. Tiempo promedio desde aprobación hasta difusión  
   3. Tasa de publicaciones rechazadas por canal  
   4. Tasa de uso de enriquecimiento por IA  
   5. Tasa de éxito en difusión por medio  
5. Los moderadores deben poder ver:  
   1. Todas las métricas generales del sistema  
   2. Reportes detallados de sus propias actividades de moderación  
   3. Reportes de publicaciones en sus áreas asignadas  
6. Los publicadores deben poder ver:  
   1. Estadísticas de sus propias publicaciones  
   2. Rendimiento de sus publicaciones por canal y medio  
   3. Historial de aprobaciones y rechazos  
7. El sistema debe almacenar métricas históricas por al menos 2 años.  
8. El dashboard debe actualizarse en tiempo real o cada 5 minutos.  
9. Los reportes deben generarse en menos de 10 segundos para conjuntos de datos de hasta 100,000 registros.  
10. El sistema debe implementar caché para reportes frecuentes para optimizar la performance.

## **H29: Auditoría y logs del sistema** {#h29:-auditoría-y-logs-del-sistema}

**COMO** administrador **QUIERO** poder acceder a logs completos de auditoría del sistema **PARA QUE** pueda investigar incidentes, cumplir con regulaciones y mantener la seguridad del sistema.

### **Criterios de aceptación** {#criterios-de-aceptación-34}

1. El sistema debe registrar automáticamente todos los eventos importantes:  
   1. Autenticación: login exitoso/fallido, logout, cambio de contraseña, recuperación de contraseña  
   2. Gestión de usuarios: creación, modificación, aprobación/rechazo, cambios de rol, habilitación/deshabilitación  
   3. Gestión de contenido: creación, edición, eliminación, archivado, cambios de estado de publicaciones  
   4. Moderación: aprobaciones, rechazos, comentarios  
   5. Enriquecimiento IA: solicitudes, respuestas, errores, costos  
   6. Difusión: intentos de difusión, éxitos, fallos  
   7. Cambios de configuración: medios, canales, permisos  
   8. Acceso a datos sensibles: visualización de información de usuarios, descarga de reportes  
   9. Errores y excepciones del sistema  
   10. Cambios en permisos y roles  
2. Cada entrada de log debe contener:  
   1. Timestamp preciso (con milisegundos)  
   2. Usuario que realizó la acción (o "sistema" para acciones automáticas)  
   3. Tipo de evento/acción  
   4. Recurso afectado (ID y tipo: usuario, publicación, canal, etc.)  
   5. Detalles del cambio (estado anterior y nuevo)  
   6. Dirección IP del usuario  
   7. User agent (navegador/dispositivo)  
   8. Resultado de la acción (éxito/fallo)  
   9. Mensaje de error (si aplica)  
   10. Nivel de severidad (info, warning, error, critical)  
3. El sistema debe permitir búsqueda y filtrado de logs:  
   1. Por rango de fechas  
   2. Por usuario  
   3. Por tipo de evento  
   4. Por recurso (ID específico)  
   5. Por nivel de severidad  
   6. Por dirección IP  
   7. Por resultado (éxito/fallo)  
   8. Búsqueda de texto libre en mensajes  
4. El sistema debe permitir:  
   1. Ver logs en interfaz paginada (50, 100, 200 registros por página)  
   2. Ver detalles completos de cada entrada de log  
   3. Exportar resultados de búsqueda en CSV o JSON  
   4. Descargar logs completos de un período (para backups)  
5. El sistema debe implementar diferentes niveles de acceso:  
   1. Administradores: acceso completo a todos los logs  
   2. Moderadores: acceso a logs de moderación y publicaciones  
   3. Publicadores: acceso solo a logs de sus propias acciones  
6. Los logs deben ser:  
   1. Inmutables (no editables ni eliminables por usuarios)  
   2. Almacenados de forma segura con backup automático  
   3. Cifrados en reposo para información sensible  
   4. Retenidos por al menos 2 años (configurable)  
   5. Archivados automáticamente después del período de retención  
7. El sistema debe alertar automáticamente sobre:  
   1. Múltiples intentos fallidos de login (5+ en 10 minutos)  
   2. Cambios masivos de permisos o roles  
   3. Eliminaciones masivas de contenido  
   4. Acceso desde ubicaciones inusuales  
   5. Errores críticos del sistema  
   6. Patrones anormales de uso (potenciales ataques)  
8. El sistema debe generar reportes automáticos de auditoría:  
   1. Resumen semanal de actividades para administradores  
   2. Alertas inmediatas para eventos críticos de seguridad  
   3. Reporte mensual de compliance (cumplimiento regulatorio)  
9. Los logs deben cumplir con estándares como ISO 27001 y GDPR para trazabilidad.  
10. El sistema debe implementar log rotation automático para prevenir que los logs consuman todo el espacio en disco.

# **Módulo de Configuración del Sistema** {#módulo-de-configuración-del-sistema}

## **H30: Configuración general del sistema** {#h30:-configuración-general-del-sistema}

**COMO** administrador **QUIERO** poder configurar parámetros generales del sistema **PARA QUE** pueda adaptar el comportamiento de la aplicación a las necesidades de la organización.

### **Criterios de aceptación** {#criterios-de-aceptación-35}

1. El sistema debe permitir configurar parámetros de autenticación:  
   1. Tiempo de expiración de tokens (1-72 horas)  
   2. Número máximo de intentos fallidos de login (3-10)  
   3. Tiempo de bloqueo después de intentos fallidos (5-60 minutos)  
   4. Duración de validez del token de verificación de email (24-168 horas)  
   5. Duración de validez del token de recuperación de contraseña (30-120 minutos)  
   6. Requerir o no caracteres especiales en contraseñas  
   7. Longitud mínima de contraseña (8-20 caracteres)  
   8. Habilitar/deshabilitar autenticación de dos factores (2FA)  
2. El sistema debe permitir configurar límites de contenido:  
   1. Tamaño máximo de archivo por tipo (imagen, video, audio, documento)  
   2. Número máximo de archivos por publicación  
   3. Tamaño total máximo por publicación  
   4. Tamaño máximo de storage por usuario  
   5. Longitud máxima de título de publicación  
   6. Longitud máxima de contenido de publicación  
   7. Número máximo de canales por publicación  
   8. Número máximo de medios por canal  
3. El sistema debe permitir configurar rate limiting:  
   1. Límite de solicitudes de API por usuario por minuto/hora  
   2. Límite de registros por IP por hora  
   3. Límite de solicitudes de enriquecimiento por usuario por hora  
   4. Límite de uploads de archivos por usuario por hora  
   5. Límite de publicaciones creadas por usuario por día  
4. El sistema debe permitir configurar notificaciones:  
   1. Habilitar/deshabilitar notificaciones por email  
   2. Habilitar/deshabilitar notificaciones push  
   3. Configurar servidor SMTP para envío de emails  
   4. Plantillas de email personalizables (HTML)  
   5. Dirección de email remitente y nombre  
5. El sistema debe permitir configurar parámetros de IA:  
   1. API key del servicio de IA  
   2. URL del endpoint de IA  
   3. Timeout para solicitudes de IA (1-10 minutos)  
   4. Número de reintentos automáticos (0-5)  
   5. Temperatura del modelo (0.0-1.0)  
   6. Modelo de IA a utilizar (GPT-4, GPT-3.5, Claude, etc.)  
   7. Límite de tokens por solicitud  
   8. Habilitar/deshabilitar caché de respuestas de IA  
6. El sistema debe permitir configurar mantenimiento:  
   1. Activar/desactivar modo mantenimiento  
   2. Mensaje personalizado de mantenimiento  
   3. Permitir acceso a administradores durante mantenimiento  
   4. Programar ventanas de mantenimiento automático  
7. El sistema debe permitir configurar almacenamiento:  
   1. Tipo de storage (local, S3, Azure Blob, Google Cloud Storage)  
   2. Credenciales de acceso a storage cloud  
   3. Bucket/contenedor a utilizar  
   4. Región del storage  
   5. Habilitar/deshabilitar CDN  
   6. Política de retención de archivos eliminados (soft delete)  
8. Todos los cambios de configuración deben:  
   1. Requerir confirmación del administrador  
   2. Ser registrados en los logs de auditoría  
   3. Mostrar el valor anterior y el nuevo  
   4. Aplicarse inmediatamente o requerir reinicio (según el parámetro)  
   5. Poder ser revertidos a valores por defecto  
9. El sistema debe validar todos los valores de configuración antes de aplicarlos.  
10. El sistema debe permitir exportar/importar la configuración completa en formato JSON para backups o migraciones.

# **Requisitos No Funcionales Importantes** {#requisitos-no-funcionales-importantes}

Además de las historias de usuario, los siguientes requisitos no funcionales son esenciales:

1. **Seguridad**: El sistema debe implementar autenticación robusta mediante Bearer Token y protección contra vulnerabilidades comunes (XSS, CSRF, inyección SQL).  
2. **Rendimiento**: La API debe responder a las solicitudes en menos de 500ms en condiciones normales y manejar al menos 100 solicitudes concurrentes.  
3. **Disponibilidad**: El sistema debe estar disponible al menos el 99.5% del tiempo durante el horario operativo de la facultad.  
4. **Escalabilidad**: La arquitectura debe permitir escalar horizontalmente para acomodar crecimiento en usuarios y publicaciones.  
5. **Integración**: Debe existir documentación clara para la integración con sistemas de frontend y dispositivos externos.  
6. **Auditoría**: Todas las acciones críticas deben ser registradas para permitir auditorías de seguridad y cumplimiento.

---

# **ANEXO: Roles y Permisos del Sistema** {#anexo:-roles-y-permisos-del-sistema}

Este anexo documenta de forma completa todos los roles del sistema, sus estados asociados y los permisos específicos que cada rol puede ejercer sobre el sistema Difexa API.

## **Estados y Roles de Usuario** {#estados-y-roles-de-usuario}

### **Estados del Usuario** {#estados-del-usuario}

Los estados representan el ciclo de vida de una cuenta de usuario:

1. **Invitado**: Usuario no registrado que puede visualizar información pública del sistema.  
2. **Registrado**: Usuario que completó el formulario de registro pero aún no ha verificado su correo electrónico.  
3. **Verificado**: Usuario que verificó su correo pero está pendiente de aprobación por un administrador.  
4. **Aprobado**: Usuario con acceso completo según su rol asignado.  
5. **Deshabilitado**: Usuario cuya cuenta ha sido suspendida temporalmente.  
6. **Eliminado**: Usuario que solicitó la eliminación permanente de su cuenta.

### **Roles del Sistema** {#roles-del-sistema}

Los roles definen las responsabilidades y capacidades de los usuarios:

1. **Invitado**: Acceso público sin autenticación.  
2. **Publicador**: Usuario autorizado para crear y gestionar publicaciones en canales asignados.  
3. **Moderador**: Usuario encargado de revisar y aprobar publicaciones antes de su difusión.  
4. **Administrador**: Usuario con control total sobre usuarios, canales, medios y configuración del sistema.  
5. **Difusor**: Agente no-humano especializado en distribuir contenido a un medio específico (pantalla, red social, plataforma).

## **Permisos por Rol** {#permisos-por-rol}

### **1\. Invitado** {#1.-invitado}

**Descripción**: Usuario no autenticado con acceso a funcionalidades públicas.

**Permisos**:

- `auth.register`: Registrarse en el sistema  
- `auth.view-public-info`: Ver información pública del sistema (landing page)  
- `channels.view-public`: Ver canales públicos disponibles

---

### **2\. Usuario Registrado** {#2.-usuario-registrado}

**Descripción**: Usuario que completó el registro pero no ha verificado su email.

**Permisos**:

- `auth.verify-email`: Verificar correo electrónico mediante token  
- `auth.resend-verification`: Solicitar reenvío de email de verificación  
- `profile.view-own`: Ver su propio perfil

---

### **3\. Usuario Verificado** {#3.-usuario-verificado}

**Descripción**: Usuario con email verificado, pendiente de aprobación administrativa.

**Permisos básicos**:

- `auth.login`: Iniciar sesión y obtener Bearer Token  
- `session.logout`: Cerrar sesión e invalidar token  
- `profile.view-own`: Ver su propio perfil  
- `profile.update`: Actualizar datos personales (nombres, apellidos, celular, avatar)  
- `profile.context.manage`: Gestionar contexto semántico personal  
- `account.password.change`: Cambiar contraseña  
- `account.email.change`: Solicitar cambio de correo electrónico  
- `account.delete`: Eliminar cuenta definitivamente  
- `channels.view-assigned`: Ver canales solicitados durante el registro  
- `notifications.view-own`: Ver notificaciones propias  
- `audit.view-own`: Ver historial de acciones propias

---

### **4\. Publicador** {#4.-publicador}

**Descripción**: Usuario aprobado con permiso para crear y gestionar publicaciones en canales autorizados.

**Hereda todos los permisos de Usuario Verificado, más**:

#### **Gestión de Publicaciones** {#gestión-de-publicaciones}

- `posts.create`: Crear nuevas publicaciones  
- `posts.view-own`: Ver todas sus publicaciones  
- `posts.view-by-channel`: Ver publicaciones de sus canales autorizados  
- `posts.edit.draft`: Editar publicaciones en estado "draft"  
- `posts.edit.publishing.limited`: Edición limitada en estado "publishing"  
- `posts.delete.own`: Eliminar sus propias publicaciones (excepto "publishing" y "archived")  
- `posts.archive.own`: Archivar sus propias publicaciones  
- `posts.restore.own`: Restaurar publicaciones archivadas propias  
- `posts.schedule`: Programar fecha/hora de publicación  
- `posts.select.channels.authorized`: Seleccionar canales entre los autorizados  
- `posts.select.media.per-channel`: Seleccionar medios por canal

#### **Enriquecimiento por IA** {#enriquecimiento-por-ia}

- `ai.enrichment.request`: Solicitar enriquecimiento automático por IA  
- `ai.enrichment.cancel`: Cancelar proceso de enriquecimiento en curso  
- `ai.enrichment.view-status`: Ver estado del proceso de enriquecimiento  
- `ai.enrichment.review.approve`: Aprobar versiones enriquecidas  
- `ai.enrichment.review.reject`: Rechazar versiones enriquecidas  
- `ai.enrichment.review.regenerate`: Solicitar regeneración de versiones  
- `ai.enrichment.review.edit`: Editar manualmente contenido enriquecido

#### **Distribución** {#distribución}

- `distribution.publish.manual`: Difundir manualmente publicación aprobada  
- `distribution.publish.scheduled`: Permitir difusión automática programada  
- `distribution.stop.own`: Detener difusión de publicaciones propias  
- `distribution.view-status`: Ver estado de distribución

#### **Canales** {#canales}

- `channels.view-assigned`: Ver canales asignados  
- `channels.view-details`: Ver detalles de canales autorizados  
- `channels.view-media`: Ver medios asociados a sus canales

#### **Archivos** {#archivos}

- `attachments.upload`: Subir archivos multimedia  
- `attachments.view-own`: Ver archivos adjuntos propios  
- `attachments.delete-own`: Eliminar archivos propios

#### **Auditoría** {#auditoría}

- `audit.view-own-posts`: Ver historial de cambios de sus publicaciones

---

### **5\. Moderador** {#5.-moderador}

**Descripción**: Usuario encargado de revisar y aprobar publicaciones antes de su difusión.

**Hereda todos los permisos de Publicador, más**:

#### **Moderación de Publicaciones** {#moderación-de-publicaciones}

- `posts.view.all-pending`: Ver todas las publicaciones pendientes de moderación  
- `posts.view.all`: Ver todas las publicaciones del sistema  
- `posts.moderate.approve`: Aprobar publicaciones para difusión  
- `posts.moderate.reject`: Rechazar publicaciones con comentarios  
- `posts.moderate.edit`: Editar publicaciones en cualquier estado  
- `posts.delete.any`: Eliminar cualquier publicación  
- `posts.archive.any`: Archivar cualquier publicación  
- `posts.restore.any`: Restaurar cualquier publicación archivada  
- `distribution.stop.any`: Detener difusión de cualquier publicación

#### **Gestión de Contenido** {#gestión-de-contenido}

- `posts.assign.moderator`: Asignar publicaciones a otros moderadores  
- `posts.comments.add`: Añadir comentarios de moderación  
- `posts.comments.view`: Ver comentarios de moderación  
- `posts.priority.set`: Establecer prioridad de moderación

#### **Canales y Medios** {#canales-y-medios}

- `channels.view.all`: Ver todos los canales  
- `media.view.all`: Ver todos los medios

#### **Auditoría** {#auditoría-1}

- `audit.view.posts`: Ver historial completo de publicaciones  
- `audit.view.moderation`: Ver historial de moderaciones

---

### **6\. Administrador** {#6.-administrador}

**Descripción**: Usuario con control total sobre el sistema, usuarios, canales y medios.

**Hereda todos los permisos de Moderador, más**:

#### **Gestión de Usuarios** {#gestión-de-usuarios}

- `users.view.all`: Ver listado completo de usuarios  
- `users.filter`: Filtrar usuarios por rol, estado, correo  
- `users.approvals.manage`: Aprobar/rechazar solicitudes de registro  
- `users.roles.assign`: Asignar roles a usuarios  
- `users.roles.revoke`: Revocar roles de usuarios  
- `users.enable`: Habilitar cuentas de usuario  
- `users.disable`: Deshabilitar cuentas de usuario  
- `users.delete`: Eliminar cuentas de usuario  
- `users.impersonate`: Iniciar sesión como otro usuario (para soporte)  
- `users.notify`: Enviar notificaciones a usuarios  
- `users.context.view`: Ver contexto semántico de usuarios  
- `users.context.edit`: Editar contexto semántico de usuarios

#### **Gestión de Medios** {#gestión-de-medios}

- `media.create`: Crear nuevos medios de publicación  
- `media.view.all`: Ver todos los medios  
- `media.edit`: Editar configuración de medios  
- `media.delete`: Eliminar medios  
- `media.enable`: Activar medios  
- `media.disable`: Desactivar medios  
- `media.context.manage`: Gestionar contexto semántico de medios  
- `media.credentials.manage`: Gestionar credenciales API de medios

#### **Gestión de Canales** {#gestión-de-canales}

- `channels.create`: Crear nuevos canales  
- `channels.view.all`: Ver todos los canales  
- `channels.edit`: Editar configuración de canales  
- `channels.delete`: Eliminar canales  
- `channels.media.assign`: Asignar medios a canales  
- `channels.media.revoke`: Revocar medios de canales  
- `channels.context.manage`: Gestionar contexto semántico de canales  
- `channels.assign.to-publisher`: Asignar canales a publicadores  
- `channels.revoke.from-publisher`: Revocar canales de publicadores

#### **Gestión de Permisos** {#gestión-de-permisos}

- `permissions.matrix.view`: Ver matriz de roles y permisos  
- `permissions.assign`: Asignar permisos a roles  
- `permissions.revoke`: Revocar permisos de roles  
- `permissions.protect.critical`: Gestionar permisos críticos del sistema  
- `roles.create`: Crear nuevos roles personalizados  
- `roles.edit`: Editar roles existentes  
- `roles.delete`: Eliminar roles personalizados

#### **Configuración del Sistema** {#configuración-del-sistema}

- `system.config.view`: Ver configuración del sistema  
- `system.config.edit`: Editar configuración del sistema  
- `system.maintenance`: Activar modo mantenimiento  
- `system.logs.view`: Ver logs del sistema  
- `system.backup.create`: Crear respaldos del sistema  
- `system.backup.restore`: Restaurar respaldos

#### **Auditoría Completa** {#auditoría-completa}

- `audit.view.all`: Ver historial completo de auditoría  
- `audit.export`: Exportar registros de auditoría  
- `audit.users`: Ver auditoría de usuarios  
- `audit.permissions`: Ver cambios en permisos  
- `audit.system`: Ver auditoría del sistema

---

### **7\. Difusor** {#7.-difusor}

**Descripción**: Agente automatizado no-humano especializado en distribuir contenido a un medio específico.

**Permisos especializados**:

- `auth.login.token`: Autenticarse mediante token único  
- `posts.consume.assigned`: Consumir publicaciones asignadas a su medio  
- `posts.filter.by-medium`: Filtrar publicaciones por medio asignado  
- `posts.view.scheduled`: Ver publicaciones en estado "scheduled"  
- `posts.view.enriched-version`: Obtener versión enriquecida específica para su medio  
- `attachments.download`: Descargar archivos multimedia  
- `distribution.report.status`: Reportar estado de difusión (éxito/fallo)  
- `distribution.update.status`: Actualizar estado de distribución  
- `distribution.log.activity`: Registrar actividad de difusión  
- `media.report.health`: Reportar estado de salud del medio  
- `api.rate-limit.extended`: Límite de tasa extendido para consumo continuo

## **Matriz de Permisos por Funcionalidad** {#matriz-de-permisos-por-funcionalidad}

| Funcionalidad | Invitado | Registrado | Verificado | Publicador | Moderador | Administrador | Difusor |
| :---- | :---- | :---- | :---- | :---- | :---- | :---- | :---- |
| **Autenticación y Registro** |  |  |  |  |  |  |  |
| Registrarse | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ | ❌ |
| Verificar email | ❌ | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ |
| Iniciar sesión | ❌ | ❌ | ✅ | ✅ | ✅ | ✅ | ✅ |
| Cerrar sesión | ❌ | ❌ | ✅ | ✅ | ✅ | ✅ | ✅ |
| **Gestión de Perfil** |  |  |  |  |  |  |  |
| Ver perfil propio | ❌ | ✅ | ✅ | ✅ | ✅ | ✅ | ❌ |
| Editar perfil | ❌ | ❌ | ✅ | ✅ | ✅ | ✅ | ❌ |
| Cambiar contraseña | ❌ | ❌ | ✅ | ✅ | ✅ | ✅ | ❌ |
| Gestionar contexto semántico | ❌ | ❌ | ✅ | ✅ | ✅ | ✅ | ❌ |
| Eliminar cuenta | ❌ | ❌ | ✅ | ✅ | ✅ | ✅ | ❌ |
| **Gestión de Usuarios** |  |  |  |  |  |  |  |
| Ver todos los usuarios | ❌ | ❌ | ❌ | ❌ | ❌ | ✅ | ❌ |
| Aprobar usuarios | ❌ | ❌ | ❌ | ❌ | ❌ | ✅ | ❌ |
| Asignar roles | ❌ | ❌ | ❌ | ❌ | ❌ | ✅ | ❌ |
| Habilitar/deshabilitar | ❌ | ❌ | ❌ | ❌ | ❌ | ✅ | ❌ |
| **Gestión de Medios** |  |  |  |  |  |  |  |
| Ver medios públicos | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ❌ |
| Ver medios asignados | ❌ | ❌ | ❌ | ✅ | ✅ | ✅ | ✅ |
| Crear/editar medios | ❌ | ❌ | ❌ | ❌ | ❌ | ✅ | ❌ |
| Eliminar medios | ❌ | ❌ | ❌ | ❌ | ❌ | ✅ | ❌ |
| **Gestión de Canales** |  |  |  |  |  |  |  |
| Ver canales públicos | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ❌ |
| Ver canales asignados | ❌ | ❌ | ✅ | ✅ | ✅ | ✅ | ❌ |
| Crear/editar canales | ❌ | ❌ | ❌ | ❌ | ❌ | ✅ | ❌ |
| Asignar canales | ❌ | ❌ | ❌ | ❌ | ❌ | ✅ | ❌ |
| **Gestión de Publicaciones** |  |  |  |  |  |  |  |
| Crear publicaciones | ❌ | ❌ | ❌ | ✅ | ✅ | ✅ | ❌ |
| Ver publicaciones propias | ❌ | ❌ | ❌ | ✅ | ✅ | ✅ | ❌ |
| Ver todas publicaciones | ❌ | ❌ | ❌ | ❌ | ✅ | ✅ | ❌ |
| Editar publicaciones | ❌ | ❌ | ❌ | ✅ | ✅ | ✅ | ❌ |
| Eliminar publicaciones | ❌ | ❌ | ❌ | ✅(propias) | ✅ | ✅ | ❌ |
| Archivar publicaciones | ❌ | ❌ | ❌ | ✅(propias) | ✅ | ✅ | ❌ |
| **Enriquecimiento IA** |  |  |  |  |  |  |  |
| Solicitar enriquecimiento | ❌ | ❌ | ❌ | ✅ | ✅ | ✅ | ❌ |
| Revisar versiones | ❌ | ❌ | ❌ | ✅ | ✅ | ✅ | ❌ |
| Aprobar/rechazar versiones | ❌ | ❌ | ❌ | ✅ | ✅ | ✅ | ❌ |
| **Moderación** |  |  |  |  |  |  |  |
| Moderar publicaciones | ❌ | ❌ | ❌ | ❌ | ✅ | ✅ | ❌ |
| Aprobar para difusión | ❌ | ❌ | ❌ | ❌ | ✅ | ✅ | ❌ |
| Rechazar publicaciones | ❌ | ❌ | ❌ | ❌ | ✅ | ✅ | ❌ |
| Detener difusión | ❌ | ❌ | ❌ | ✅(propias) | ✅ | ✅ | ❌ |
| **Distribución** |  |  |  |  |  |  |  |
| Programar publicación | ❌ | ❌ | ❌ | ✅ | ✅ | ✅ | ❌ |
| Difusión manual | ❌ | ❌ | ❌ | ✅ | ✅ | ✅ | ❌ |
| Consumir publicaciones | ❌ | ❌ | ❌ | ❌ | ❌ | ❌ | ✅ |
| Reportar estado difusión | ❌ | ❌ | ❌ | ❌ | ❌ | ❌ | ✅ |
| **Permisos y Roles** |  |  |  |  |  |  |  |
| Ver matriz permisos | ❌ | ❌ | ❌ | ❌ | ❌ | ✅ | ❌ |
| Gestionar permisos | ❌ | ❌ | ❌ | ❌ | ❌ | ✅ | ❌ |
| **Auditoría** |  |  |  |  |  |  |  |
| Ver auditoría propia | ❌ | ❌ | ✅ | ✅ | ✅ | ✅ | ❌ |
| Ver auditoría completa | ❌ | ❌ | ❌ | ❌ | Parcial | ✅ | ❌ |
| Exportar auditoría | ❌ | ❌ | ❌ | ❌ | ❌ | ✅ | ❌ |

---

## **Flujo de Estados de Publicación** {#flujo-de-estados-de-publicación}

Las publicaciones transitan por los siguientes estados según las acciones realizadas:

draft → publishing → (moderación) → scheduled → archived

   ↑        ↓              ↓              ↓

   └────────┴──────────────┴──────────────┘

          (edición/corrección)

### **Descripción de Estados** {#descripción-de-estados}

1. **draft**: Publicación en creación o borrador, editable completamente por el publicador.  
2. **publishing**: Publicación en proceso de enriquecimiento por IA o esperando moderación.  
3. **scheduled**: Publicación aprobada y lista para difusión (manual o programada).  
4. **archived**: Publicación archivada que no se procesa ni muestra en listados activos.

### **Transiciones Permitidas** {#transiciones-permitidas}

| Estado Actual | Acción | Estado Siguiente | Roles Autorizados |
| :---- | :---- | :---- | :---- |
| draft | Solicitar enriquecimiento | publishing | Publicador, Moderador, Admin |
| publishing | Aprobar moderación | scheduled | Moderador, Admin |
| publishing | Rechazar moderación | draft | Moderador, Admin |
| publishing | Detener difusión | draft | Publicador (propio), Moderador, Admin |
| scheduled | Ejecutar difusión | scheduled | Sistema, Difusor |
| scheduled | Archivar | archived | Publicador (propio), Moderador, Admin |
| scheduled | Editar | draft | Publicador (propio), Moderador, Admin |
| archived | Restaurar | draft | Publicador (propio), Moderador, Admin |

---

## **Permisos Críticos del Sistema** {#permisos-críticos-del-sistema}

Los siguientes permisos están protegidos y no pueden ser revocados sin autorización especial:

1. `system.config.edit`: Editar configuración del sistema  
2. `permissions.assign`: Asignar permisos a roles  
3. `permissions.revoke`: Revocar permisos de roles  
4. `users.delete`: Eliminar cuentas de usuario  
5. `system.backup.restore`: Restaurar respaldos del sistema  
6. `audit.view.all`: Ver auditoría completa  
7. `permissions.protect.critical`: Gestionar permisos críticos

Solo los administradores con autorización especial pueden modificar estos permisos.

---

## **Implementación con Spatie Laravel Permission** {#implementación-con-spatie-laravel-permission}

Para implementar este sistema de roles y permisos en Laravel, se recomienda:

1. **Instalar spatie/laravel-permission**:

   composer require spatie/laravel-permission

   php artisan vendor:publish \--provider="Spatie\\Permission\\PermissionServiceProvider"

   php artisan migrate

2. **Crear seeder de roles y permisos** basado en la matriz anterior.  
3. **Asignar roles a usuarios** mediante:

   $user-\>assignRole('publicador');

4. **Verificar permisos en middleware** o políticas:

   $user-\>can('posts.create');

5. **Proteger rutas** con middleware:

   Route::middleware(\['permission:posts.create'\])-\>group(function () {

      // Rutas protegidas

   });

   

1. Descargar este documento como markdown  
2. Copiarlo en su repositorio  
3. Van a Chat de Copilot en modo Agente, con modelo Claude 4.5, y le piden:  
4. Asume el rol de experto en microservicios REST, analiza las historias de usuario definidas en el documento \# (documento md que está en su repo) y define las rutas ÚNICAMENTE para la historia de usuario (?). Comienza con “/api/”